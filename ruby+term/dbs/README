= dbsサンプル

testテーブルに2件レコードをinsertしてfetchする

= ビルド

$ make

= 動作方法

== 準備

データベースユーザとデータベースを作成しておく必要があります。

$ sudo -u postgres createuser $USER -A -d 
$ createdb -l C -E UTF8 -T template0 test
$ psql < test.sql

日レセ標準dbsは止めておく。

% /etc/init.d/jma-receipt-dbs stop

== サーバ起動

$ ./service.sh start

== クライアントスクリプト実行

% ruby test.rb
DBOPEN 0
DBSTART 0
DBINSERT
DBCOMMIT 0
DBSTART 0
DBINSERT
DBCOMMIT 0
DBSTART 0
DBSELECT
{"test.price"=>"0100.00", "test.name"=>"hoge", "test.id"=>"1"}
{"test.price"=>"0100.00", "test.name"=>nil, "test.id"=>"2"}
DBDISCONNECT 0

% psql test
test=# select * from test;
 id | name | price
----+------+--------
  1 | hoge | 100.00
  2 |      | 100.00
(2 rows)

test=# select * from test where name = '';
 id | name | price
----+------+--------
  2 |      | 100.00
(1 row)

test=# select * from test where name is null;
 id | name | price
----+------+-------
(0 rows)

== サーバ終了

$ ./service.sh stop

